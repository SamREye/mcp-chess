(()=>{var e={};e.id=739,e.ids=[739],e.modules={33899:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=33899,e.exports=t},53524:e=>{"use strict";e.exports=require("@prisma/client")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},86624:e=>{"use strict";e.exports=require("querystring")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},40414:()=>{},35531:()=>{},30005:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>b,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>x,staticGenerationAsyncStorage:()=>d});var s={};r.r(s),r.d(s,{GET:()=>c});var i=r(12085),n=r(31650),o=r(85980),u=r(42073),a=r(76148);async function c(){try{var e;let t=await (0,u.I)(),r=await (0,a.Zg)((e=t?.user?.id??null)?`user:${e}`:`anon:${crypto.randomUUID()}`);return Response.json(r)}catch(t){let e=t instanceof Error?t.message:"Unable to create Ably token";return Response.json({error:e},{status:503})}}let l=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/ably/token/route",pathname:"/api/ably/token",filename:"route",bundlePath:"app/api/ably/token/route"},resolvedPagePath:"/Users/samuelbourque/codex/mcp-chess/app/api/ably/token/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:x}=l,g="/api/ably/token/route";function b(){return(0,o.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:d})}},76148:(e,t,r)=>{"use strict";r.d(t,{FZ:()=>u,OZ:()=>a,Zg:()=>o});var s=r(2589);let i=null;function n(){if(i)return i;let e=process.env.ABLY_API_KEY;return e?i=new s.Rest({key:e}):null}async function o(e){let t=n();if(!t)throw Error("ABLY_API_KEY is not configured");return t.auth.createTokenRequest({clientId:e,capability:JSON.stringify({"game:*":["subscribe"],games:["subscribe"]}),ttl:36e5})}async function u(e,t,r){let s=n();if(!s)return{sent:!1,skippedReason:"ABLY_API_KEY is not configured"};try{return await s.channels.get(`game:${e}`).publish(t,{...r,gameId:e,emittedAt:new Date().toISOString()}),{sent:!0}}catch(e){return console.error("Failed to publish Ably game event",e),{sent:!1,error:e instanceof Error?e.message:"Ably publish failed"}}}async function a(e,t){let r=n();if(!r)return{sent:!1,skippedReason:"ABLY_API_KEY is not configured"};try{return await r.channels.get("games").publish(e,{...t,emittedAt:new Date().toISOString()}),{sent:!0}}catch(e){return console.error("Failed to publish Ably games event",e),{sent:!1,error:e instanceof Error?e.message:"Ably publish failed"}}}},42073:(e,t,r)=>{"use strict";r.d(t,{I:()=>c,L:()=>a});var s=r(96403),i=r(20600),n=r(34512),o=r(7750);let u=[];process.env.GOOGLE_ID&&process.env.GOOGLE_SECRET&&u.push((0,n.Z)({clientId:process.env.GOOGLE_ID,clientSecret:process.env.GOOGLE_SECRET}));let a={adapter:(0,s.N)(o.db),session:{strategy:"database"},providers:u,callbacks:{session:({session:e,user:t})=>(e.user&&(e.user.id=t.id),e)}};function c(){return(0,i.getServerSession)(a)}},7750:(e,t,r)=>{"use strict";r.d(t,{db:()=>o});var s=r(53524);let i=require("node:path");var n=r.n(i);let o=global.prisma||new s.PrismaClient({datasources:{db:{url:function(e){if(!e||!e.startsWith("file:"))return e;let t=e.slice(5);if(t.startsWith("/")||t.startsWith("//"))return e;let r=n().resolve(process.cwd(),t);return`file:${r}`}(process.env.DATABASE_URL)}},log:["error"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[719,976,35],()=>r(30005));module.exports=s})();