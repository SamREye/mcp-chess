(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5709:function(e,t,n){Promise.resolve().then(n.bind(n,8457))},8457:function(e,t,n){"use strict";n.d(t,{GameListPanel:function(){return u}});var s=n(3890),a=n(9498),i=n.n(a),l=n(1020),r=n(8496),o=n(9297);let c=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;function u(e){var t,n;let{currentUserId:a}=e,u=(0,l.useRouter)(),[d,m]=(0,r.useState)(a?"my":"others"),[h,v]=(0,r.useState)([]),[p,g]=(0,r.useState)(!1),[j,y]=(0,r.useState)(null),[f,x]=(0,r.useState)(""),[N,b]=(0,r.useState)([]),[w,C]=(0,r.useState)(null),[k,S]=(0,r.useState)("white"),[_,E]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=!1;async function t(){g(!0),y(null);try{let t=await (0,o._)("list_games",{scope:"my"===d?"my":"others",limit:40});e||v(t.games)}catch(t){e||(y(t instanceof Error?t.message:"Failed to load games"),v([]))}finally{e||g(!1)}}if(!a&&"my"===d){v([]),g(!1);return}return t(),()=>{e=!0}},[d,a]),(0,r.useEffect)(()=>{let e=!1,t=setTimeout(async()=>{let t=f.trim();if(!t){b([]);return}try{let n=await (0,o._)("query_users_by_email",{query:t,limit:10});e||b(n.users.filter(e=>e.id!==a))}catch(t){e||b([])}},250);return()=>{e=!0,clearTimeout(t)}},[f,a]);let O=f.trim().toLowerCase(),L=(0,r.useMemo)(()=>N.find(e=>{var t;return(null===(t=e.email)||void 0===t?void 0:t.toLowerCase())===O}),[N,O]),G=null!=L?L:w,I=null!==(n=null==G?void 0:null===(t=G.email)||void 0===t?void 0:t.toLowerCase())&&void 0!==n?n:c.test(O)?O:null,P=!!(I&&!G);async function M(){if(I){y(null),E(null);try{let e=await (0,o._)("new_game",{opponentEmail:I,playAs:k});e.invitation.sent?E("Invitation email sent."):e.invitation.skippedReason?E("Invitation not sent: ".concat(e.invitation.skippedReason)):e.invitation.error&&E("Invitation failed: ".concat(e.invitation.error)),u.push("/games/".concat(e.game.id)),u.refresh()}catch(e){y(e instanceof Error?e.message:"Failed to create game")}}}return(0,s.jsxs)("section",{className:"grid-2",children:[(0,s.jsxs)("div",{className:"panel stack",children:[(0,s.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,s.jsx)("h2",{style:{margin:0},children:"Game List"}),(0,s.jsxs)("div",{className:"tabs",children:[(0,s.jsx)("button",{className:"tab ".concat("my"===d?"active":""),onClick:()=>m("my"),type:"button",children:"My Games"}),(0,s.jsx)("button",{className:"tab ".concat("others"===d?"active":""),onClick:()=>m("others"),type:"button",children:"Others' Games"})]})]}),a||"my"!==d?p?(0,s.jsx)("p",{className:"muted",children:"Loading games..."}):0===h.length?(0,s.jsx)("p",{className:"muted",children:"No games in this tab yet."}):(0,s.jsx)("ul",{className:"game-list",children:h.map(e=>{var t,n;return(0,s.jsxs)("li",{children:[(0,s.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,s.jsxs)("strong",{children:[null!==(t=e.white.email)&&void 0!==t?t:e.white.id," vs ",null!==(n=e.black.email)&&void 0!==n?n:e.black.id]}),(0,s.jsx)("span",{children:e.status})]}),(0,s.jsxs)("p",{className:"muted",children:[e.moveCount," moves â€¢ updated ",new Date(e.updatedAt).toLocaleString()]}),(0,s.jsx)(i(),{href:"/games/".concat(e.id),children:"Open game"})]},e.id)})}):(0,s.jsx)("p",{className:"muted",children:"Sign in to view your games."}),j&&(0,s.jsx)("p",{className:"error",children:j})]}),(0,s.jsxs)("div",{className:"panel stack",children:[(0,s.jsx)("h2",{style:{margin:0},children:"New Game"}),a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("label",{children:["Opponent email (or name)",(0,s.jsx)("input",{value:f,onChange:e=>{C(null),x(e.target.value)},placeholder:"Search by name/email or enter email"})]}),N.length>0&&(0,s.jsx)("ul",{className:"game-list",children:N.map(e=>{var t,n;return(0,s.jsx)("li",{children:(0,s.jsxs)("button",{type:"button",onClick:()=>{e.email&&(C(e),x(e.email))},style:{all:"unset",cursor:"pointer"},children:[(0,s.jsx)("strong",{children:null!==(t=e.email)&&void 0!==t?t:e.id}),(0,s.jsx)("p",{className:"muted",children:null!==(n=e.name)&&void 0!==n?n:"No name set"})]})},e.id)})}),P&&(0,s.jsx)("p",{className:"muted",children:"This email is not registered yet. You can still create the game and send an invitation."}),(0,s.jsxs)("label",{children:["You play as",(0,s.jsxs)("select",{value:k,onChange:e=>S(e.target.value),children:[(0,s.jsx)("option",{value:"white",children:"White"}),(0,s.jsx)("option",{value:"black",children:"Black"})]})]}),(0,s.jsx)("button",{type:"button",className:"primary",disabled:!I,onClick:()=>void M(),children:"Create game"}),_&&(0,s.jsx)("p",{className:"muted",children:_})]}):(0,s.jsx)("p",{className:"muted",children:"Sign in to create games and move pieces."})]})]})}},9297:function(e,t,n){"use strict";async function s(e){var t,n,s,a,i;let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=await fetch("/api/mcp",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:crypto.randomUUID(),method:"tools/call",params:{name:e,arguments:l}}),credentials:"same-origin"}),o=await r.json();if(o.error)throw Error(null!==(i=o.error.message)&&void 0!==i?i:"MCP call failed");let c=null==o?void 0:null===(t=o.result)||void 0===t?void 0:t.structuredContent;if(void 0!==c)return c;let u=null==o?void 0:null===(a=o.result)||void 0===a?void 0:null===(s=a.content)||void 0===s?void 0:null===(n=s[0])||void 0===n?void 0:n.text;if("string"==typeof u)return JSON.parse(u);throw Error("Invalid MCP response")}n.d(t,{_:function(){return s}})}},function(e){e.O(0,[498,649,945,744],function(){return e(e.s=5709)}),_N_E=e.O()}]);